#!/usr/bin/env python
import os
import subprocess

path = os.path.dirname(os.path.abspath(__file__))
tests_path = '%s/../tests' % path

test_results = ["FAILED", "PASSED"]
test_name = "untyped_constants/boolean"

original_file_path = '%s/%s/original.goa' % (tests_path, test_name)
original = open(original_file_path, "r").read()
precompiled = open('%s/%s/precompiled.go' % (tests_path, test_name), "r").read()
output = open('%s/%s/output' % (tests_path, test_name), "r").read()

os.popen('go run %s/.. %s' % (path, original_file_path)).read()

result_precompiled_file_path = '%s/../out/output.go' % path
result_precompiled = open(result_precompiled_file_path, "r").read()

process = subprocess.Popen(['go', 'run', result_precompiled_file_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
_, result_output = process.communicate()

print("TEST %s %s" % (test_name, test_results[result_precompiled == precompiled and result_output == output]))